// Generated by CoffeeScript 1.6.3
(function() {
  var $, Spine, escapeRegExp, hashStrip, namedParam, splatParam,
    __hasProp = {}.hasOwnProperty,
    __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; },
    __slice = [].slice;

  Spine = this.Spine || require('spine');

  $ = Spine.$;

  hashStrip = /^#*/;

  namedParam = /:([\w\d]+)/g;

  splatParam = /\*([\w\d]+)/g;

  escapeRegExp = /[-[\]{}()+?.,\\^$|#\s]/g;

  Spine.Route = (function(_super) {
    var _ref;

    __extends(Route, _super);

    Route.extend(Spine.Events);

    Route.historySupport = ((_ref = window.history) != null ? _ref.pushState : void 0) != null;

    Route.routes = [];

    Route.options = {
      trigger: true,
      history: false,
      shim: false,
      replace: false,
      redirect: false
    };

    Route.add = function(path, callback) {
      var key, value, _results;
      if (typeof path === 'object' && !(path instanceof RegExp)) {
        _results = [];
        for (key in path) {
          value = path[key];
          _results.push(this.add(key, value));
        }
        return _results;
      } else {
        return this.routes.push(new this(path, callback));
      }
    };

    Route.setup = function(options) {
      if (options == null) {
        options = {};
      }
      this.options = $.extend({}, this.options, options);
      if (this.options.history) {
        this.history = this.historySupport && this.options.history;
      }
      if (this.options.shim) {
        return;
      }
      if (this.history) {
        $(window).bind('popstate', this.change);
      } else {
        $(window).bind('hashchange', this.change);
      }
      return this.change();
    };

    Route.unbind = function() {
      if (this.options.shim) {
        return;
      }
      if (this.history) {
        return $(window).unbind('popstate', this.change);
      } else {
        return $(window).unbind('hashchange', this.change);
      }
    };

    Route.navigate = function() {
      var args, lastArg, options, path, route;
      args = 1 <= arguments.length ? __slice.call(arguments, 0) : [];
      options = {};
      lastArg = args[args.length - 1];
      if (typeof lastArg === 'object') {
        options = args.pop();
      } else if (typeof lastArg === 'boolean') {
        options.trigger = args.pop();
      }
      options = $.extend({}, this.options, options);
      path = args.join('/');
      if (this.path === path) {
        return;
      }
      this.path = path;
      this.trigger('navigate', this.path);
      if (options.trigger) {
        route = this.matchRoute(this.path, options);
      }
      if (options.shim) {
        return;
      }
      if (!route) {
        if (typeof options.redirect === 'function') {
          return options.redirect.apply(this, [this.path, options]);
        } else {
          if (options.redirect === true) {
            this.redirect(this.path);
          }
        }
      }
      if (this.history && options.replace) {
        return history.replaceState({}, document.title, this.path);
      } else if (this.history) {
        return history.pushState({}, document.title, this.path);
      } else {
        return window.location.hash = this.path;
      }
    };

    Route.getPath = function() {
      var path;
      if (this.history) {
        path = window.location.pathname;
        if (path.substr(0, 1) !== '/') {
          path = '/' + path;
        }
      } else {
        path = window.location.hash;
        path = path.replace(hashStrip, '');
      }
      return path;
    };

    Route.getHost = function() {
      return "" + window.location.protocol + "//" + window.location.host;
    };

    Route.change = function() {
      var path;
      path = this.getPath();
      if (path === this.path) {
        return;
      }
      this.path = path;
      return this.matchRoute(this.path);
    };

    Route.matchRoute = function(path, options) {
      var route, _i, _len, _ref1;
      _ref1 = this.routes;
      for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
        route = _ref1[_i];
        if (!(route.match(path, options))) {
          continue;
        }
        this.trigger('change', route, path);
        return route;
      }
    };

    Route.redirect = function(path) {
      return window.location = path;
    };

    function Route(path, callback) {
      var match;
      this.path = path;
      this.callback = callback;
      this.names = [];
      if (typeof path === 'string') {
        namedParam.lastIndex = 0;
        while ((match = namedParam.exec(path)) !== null) {
          this.names.push(match[1]);
        }
        splatParam.lastIndex = 0;
        while ((match = splatParam.exec(path)) !== null) {
          this.names.push(match[1]);
        }
        path = path.replace(escapeRegExp, '\\$&').replace(namedParam, '([^\/]*)').replace(splatParam, '(.*?)');
        this.route = new RegExp("^" + path + "$");
      } else {
        this.route = path;
      }
    }

    Route.prototype.match = function(path, options) {
      var i, match, param, params, _i, _len;
      if (options == null) {
        options = {};
      }
      match = this.route.exec(path);
      if (!match) {
        return false;
      }
      options.match = match;
      params = match.slice(1);
      if (this.names.length) {
        for (i = _i = 0, _len = params.length; _i < _len; i = ++_i) {
          param = params[i];
          options[this.names[i]] = param;
        }
      }
      return this.callback.call(null, options) !== false;
    };

    return Route;

  })(Spine.Module);

  Spine.Route.change = Spine.Route.proxy(Spine.Route.change);

  Spine.Controller.include({
    route: function(path, callback) {
      return Spine.Route.add(path, this.proxy(callback));
    },
    routes: function(routes) {
      var key, value, _results;
      _results = [];
      for (key in routes) {
        value = routes[key];
        _results.push(this.route(key, value));
      }
      return _results;
    },
    navigate: function() {
      return Spine.Route.navigate.apply(Spine.Route, arguments);
    }
  });

  if (typeof module !== "undefined" && module !== null) {
    module.exports = Spine.Route;
  }

}).call(this);

/*
//@ sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicm91dGUuanMiLCJzb3VyY2VSb290IjoiLi4iLCJzb3VyY2VzIjpbInNyYy9yb3V0ZS5jb2ZmZWUiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBO0NBQUEsS0FBQSxtREFBQTtLQUFBOzt1QkFBQTs7Q0FBQSxDQUFBLENBQVEsQ0FBQyxDQUFULEVBQWtCOztDQUFsQixDQUNBLENBQVEsRUFBSzs7Q0FEYixDQUdBLENBQWUsRUFIZixJQUdBOztDQUhBLENBSUEsQ0FBZSxPQUFmLEdBSkE7O0NBQUEsQ0FLQSxDQUFlLE9BQWYsSUFMQTs7Q0FBQSxDQU1BLENBQWUsU0FBZixhQU5BOztDQUFBLENBUU0sR0FBSztDQUNULEdBQUEsSUFBQTs7Q0FBQTs7Q0FBQSxHQUFBLENBQUMsQ0FBRDs7Q0FBQSxFQUVpQixDQUFqQixDQUFDLFNBQUQscURBRkE7O0NBQUEsQ0FBQSxDQUlTLENBQVQsQ0FBQyxDQUFEOztDQUpBLEVBT0UsQ0FERixDQUFDLEVBQUQ7Q0FDRSxDQUFTLEVBQVQsRUFBQSxDQUFBO0NBQUEsQ0FDUyxHQURULENBQ0EsQ0FBQTtDQURBLENBRU0sRUFBTixDQUZBLENBRUE7Q0FGQSxDQUdTLEdBSFQsQ0FHQSxDQUFBO0NBSEEsQ0FJVSxHQUpWLENBSUEsRUFBQTtDQVhGLEtBQUE7O0NBQUEsQ0FhYSxDQUFiLENBQUEsQ0FBQyxHQUFLLENBQUM7Q0FDTCxTQUFBLFVBQUE7QUFBSSxDQUFKLEdBQUksQ0FBZSxDQUFuQixFQUFJLElBQWdEO0FBQ2xELENBQUE7V0FBQSxHQUFBOzZCQUFBO0NBQUEsQ0FBVSxDQUFWLENBQUMsQ0FBRDtDQUFBO3lCQURGO01BQUEsRUFBQTtDQUdHLENBQXdCLEVBQXhCLEVBQU0sRUFBVSxPQUFqQjtRQUpFO0NBYk4sSUFhTTs7Q0FiTixFQW1CUSxDQUFSLENBQUMsRUFBTyxFQUFDOztHQUFVLEtBQVY7UUFDUDtDQUFBLENBQVcsQ0FBQSxDQUFWLEVBQUQsQ0FBQTtDQUVBLEdBQUksRUFBSixDQUFZO0NBQ1YsRUFBVyxDQUFW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OzZCQUFBO0NBQ0UsRUFBcUIsQ0FBWixDQUFNLEVBQVAsR0FBUjtDQURGLFFBREY7UUFMQTtDQVNDLENBQW9CLEVBQXBCLENBQWtDLEVBQW5DLENBQVMsS0FBVDtDQXRJRixJQTRITzs7Q0E1SFA7O0NBRHdCLElBQUs7O0NBUi9CLENBa0pBLENBQXFCLEVBQWhCLENBQUw7O0NBbEpBLENBb0pBLEdBQUssRUFBTCxHQUFnQjtDQUNkLENBQU8sQ0FBQSxDQUFQLENBQUEsR0FBTyxDQUFDO0NBQ0EsQ0FBZ0IsQ0FBdEIsQ0FBQSxDQUFLLEdBQWlCLEtBQXRCO0NBREYsSUFBTztDQUFQLENBR1EsQ0FBQSxDQUFSLEVBQUEsR0FBUztDQUNQLFNBQUEsVUFBQTtBQUFBLENBQUE7WUFBQSxDQUFBOzZCQUFBO0NBQUEsQ0FBWSxDQUFaLENBQUMsQ0FBRDtDQUFBO3VCQURNO0NBSFIsSUFHUTtDQUhSLENBTVUsQ0FBQSxDQUFWLElBQUEsQ0FBVTtDQUNGLENBQWtDLEdBQW5DLEdBQWUsQ0FBcEIsSUFBQTtDQVBGLElBTVU7Q0EzSlosR0FvSkE7OztDQVVRLEVBQVUsQ0FBbEIsQ0FBdUIsQ0FBakIsQ0FBTjtJQTlKQTtDQUFBIiwic291cmNlc0NvbnRlbnQiOlsiU3BpbmUgPSBAU3BpbmUgb3IgcmVxdWlyZSgnc3BpbmUnKVxuJCAgICAgPSBTcGluZS4kXG5cbmhhc2hTdHJpcCAgICA9IC9eIyovXG5uYW1lZFBhcmFtICAgPSAvOihbXFx3XFxkXSspL2dcbnNwbGF0UGFyYW0gICA9IC9cXCooW1xcd1xcZF0rKS9nXG5lc2NhcGVSZWdFeHAgPSAvWy1bXFxde30oKSs/LixcXFxcXiR8I1xcc10vZ1xuXG5jbGFzcyBTcGluZS5Sb3V0ZSBleHRlbmRzIFNwaW5lLk1vZHVsZVxuICBAZXh0ZW5kIFNwaW5lLkV2ZW50c1xuXG4gIEBoaXN0b3J5U3VwcG9ydDogd2luZG93Lmhpc3Rvcnk/LnB1c2hTdGF0ZT9cblxuICBAcm91dGVzOiBbXVxuXG4gIEBvcHRpb25zOlxuICAgIHRyaWdnZXI6IHRydWVcbiAgICBoaXN0b3J5OiBmYWxzZVxuICAgIHNoaW06IGZhbHNlXG4gICAgcmVwbGFjZTogZmFsc2VcbiAgICByZWRpcmVjdDogZmFsc2VcblxuICBAYWRkOiAocGF0aCwgY2FsbGJhY2spIC0+XG4gICAgaWYgKHR5cGVvZiBwYXRoIGlzICdvYmplY3QnIGFuZCBwYXRoIG5vdCBpbnN0YW5jZW9mIFJlZ0V4cClcbiAgICAgIEBhZGQoa2V5LCB2YWx1ZSkgZm9yIGtleSwgdmFsdWUgb2YgcGF0aFxuICAgIGVsc2VcbiAgICAgIEByb3V0ZXMucHVzaChuZXcgQChwYXRoLCBjYWxsYmFjaykpXG5cbiAgQHNldHVwOiAob3B0aW9ucyA9IHt9KSAtPlxuICAgIEBvcHRpb25zID0gJC5leHRlbmQoe30sIEBvcHRpb25zLCBvcHRpb25zKVxuXG4gICAgaWYgKEBvcHRpb25zLmhpc3RvcnkpXG4gICAgICBAaGlzdG9yeSA9IEBoaXN0b3J5U3VwcG9ydCBhbmQgQG9wdGlvbnMuaGlzdG9yeVxuXG4gICAgcmV0dXJuIGlmIEBvcHRpb25zLnNoaW1cblxuICAgIGlmIEBoaXN0b3J5XG4gICAgICAkKHdpbmRvdykuYmluZCgncG9wc3RhdGUnLCBAY2hhbmdlKVxuICAgIGVsc2VcbiAgICAgICQod2luZG93KS5iaW5kKCdoYXNoY2hhbmdlJywgQGNoYW5nZSlcbiAgICBAY2hhbmdlKClcblxuICBAdW5iaW5kOiAtPlxuICAgIHJldHVybiBpZiBAb3B0aW9ucy5zaGltXG5cbiAgICBpZiBAaGlzdG9yeVxuICAgICAgJCh3aW5kb3cpLnVuYmluZCgncG9wc3RhdGUnLCBAY2hhbmdlKVxuICAgIGVsc2VcbiAgICAgICQod2luZG93KS51bmJpbmQoJ2hhc2hjaGFuZ2UnLCBAY2hhbmdlKVxuXG4gIEBuYXZpZ2F0ZTogKGFyZ3MuLi4pIC0+XG4gICAgb3B0aW9ucyA9IHt9XG5cbiAgICBsYXN0QXJnID0gYXJnc1thcmdzLmxlbmd0aCAtIDFdXG4gICAgaWYgdHlwZW9mIGxhc3RBcmcgaXMgJ29iamVjdCdcbiAgICAgIG9wdGlvbnMgPSBhcmdzLnBvcCgpXG4gICAgZWxzZSBpZiB0eXBlb2YgbGFzdEFyZyBpcyAnYm9vbGVhbidcbiAgICAgIG9wdGlvbnMudHJpZ2dlciA9IGFyZ3MucG9wKClcblxuICAgIG9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgQG9wdGlvbnMsIG9wdGlvbnMpXG5cbiAgICBwYXRoID0gYXJncy5qb2luKCcvJylcbiAgICByZXR1cm4gaWYgQHBhdGggaXMgcGF0aFxuICAgIEBwYXRoID0gcGF0aFxuXG4gICAgQHRyaWdnZXIoJ25hdmlnYXRlJywgQHBhdGgpXG5cbiAgICByb3V0ZSA9IEBtYXRjaFJvdXRlKEBwYXRoLCBvcHRpb25zKSBpZiBvcHRpb25zLnRyaWdnZXJcblxuICAgIHJldHVybiBpZiBvcHRpb25zLnNoaW1cblxuICAgIGlmICFyb3V0ZSBcbiAgICAgIGlmIHR5cGVvZiBvcHRpb25zLnJlZGlyZWN0IGlzICdmdW5jdGlvbidcbiAgICAgICAgcmV0dXJuIG9wdGlvbnMucmVkaXJlY3QuYXBwbHkgdGhpcywgW0BwYXRoLCBvcHRpb25zXVxuICAgICAgZWxzZSBcbiAgICAgICAgaWYgb3B0aW9ucy5yZWRpcmVjdCBpcyB0cnVlXG4gICAgICAgICAgQHJlZGlyZWN0KEBwYXRoKVxuXG4gICAgaWYgQGhpc3RvcnkgYW5kIG9wdGlvbnMucmVwbGFjZVxuICAgICAgaGlzdG9yeS5yZXBsYWNlU3RhdGUoe30sIGRvY3VtZW50LnRpdGxlLCBAcGF0aClcbiAgICBlbHNlIGlmIEBoaXN0b3J5XG4gICAgICBoaXN0b3J5LnB1c2hTdGF0ZSh7fSwgZG9jdW1lbnQudGl0bGUsIEBwYXRoKVxuICAgIGVsc2VcbiAgICAgIHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gQHBhdGhcblxuICAjIFByaXZhdGVcblxuICBAZ2V0UGF0aDogLT5cbiAgICBpZiBAaGlzdG9yeVxuICAgICAgcGF0aCA9IHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZVxuICAgICAgcGF0aCA9ICcvJyArIHBhdGggaWYgcGF0aC5zdWJzdHIoMCwxKSBpc250ICcvJ1xuICAgIGVsc2VcbiAgICAgIHBhdGggPSB3aW5kb3cubG9jYXRpb24uaGFzaFxuICAgICAgcGF0aCA9IHBhdGgucmVwbGFjZShoYXNoU3RyaXAsICcnKVxuICAgIHBhdGhcblxuICBAZ2V0SG9zdDogLT5cbiAgICBcIiN7d2luZG93LmxvY2F0aW9uLnByb3RvY29sfS8vI3t3aW5kb3cubG9jYXRpb24uaG9zdH1cIlxuXG4gIEBjaGFuZ2U6IC0+XG4gICAgcGF0aCA9IEBnZXRQYXRoKClcbiAgICByZXR1cm4gaWYgcGF0aCBpcyBAcGF0aFxuICAgIEBwYXRoID0gcGF0aFxuICAgIEBtYXRjaFJvdXRlKEBwYXRoKVxuXG4gIEBtYXRjaFJvdXRlOiAocGF0aCwgb3B0aW9ucykgLT5cbiAgICBmb3Igcm91dGUgaW4gQHJvdXRlcyB3aGVuIHJvdXRlLm1hdGNoKHBhdGgsIG9wdGlvbnMpXG4gICAgICBAdHJpZ2dlcignY2hhbmdlJywgcm91dGUsIHBhdGgpXG4gICAgICByZXR1cm4gcm91dGVcblxuICBAcmVkaXJlY3Q6IChwYXRoKSAtPlxuICAgIHdpbmRvdy5sb2NhdGlvbiA9IHBhdGhcblxuICBjb25zdHJ1Y3RvcjogKEBwYXRoLCBAY2FsbGJhY2spIC0+XG4gICAgQG5hbWVzID0gW11cblxuICAgIGlmIHR5cGVvZiBwYXRoIGlzICdzdHJpbmcnXG4gICAgICBuYW1lZFBhcmFtLmxhc3RJbmRleCA9IDBcbiAgICAgIHdoaWxlIChtYXRjaCA9IG5hbWVkUGFyYW0uZXhlYyhwYXRoKSkgIT0gbnVsbFxuICAgICAgICBAbmFtZXMucHVzaChtYXRjaFsxXSlcblxuICAgICAgc3BsYXRQYXJhbS5sYXN0SW5kZXggPSAwXG4gICAgICB3aGlsZSAobWF0Y2ggPSBzcGxhdFBhcmFtLmV4ZWMocGF0aCkpICE9IG51bGxcbiAgICAgICAgQG5hbWVzLnB1c2gobWF0Y2hbMV0pXG5cbiAgICAgIHBhdGggPSBwYXRoLnJlcGxhY2UoZXNjYXBlUmVnRXhwLCAnXFxcXCQmJylcbiAgICAgICAgICAgICAgICAgLnJlcGxhY2UobmFtZWRQYXJhbSwgJyhbXlxcL10qKScpXG4gICAgICAgICAgICAgICAgIC5yZXBsYWNlKHNwbGF0UGFyYW0sICcoLio/KScpXG5cbiAgICAgIEByb3V0ZSA9IG5ldyBSZWdFeHAoXCJeI3twYXRofSRcIilcbiAgICBlbHNlXG4gICAgICBAcm91dGUgPSBwYXRoXG5cbiAgbWF0Y2g6IChwYXRoLCBvcHRpb25zID0ge30pIC0+XG4gICAgbWF0Y2ggPSBAcm91dGUuZXhlYyhwYXRoKVxuICAgIHJldHVybiBmYWxzZSB1bmxlc3MgbWF0Y2hcbiAgICBvcHRpb25zLm1hdGNoID0gbWF0Y2hcbiAgICBwYXJhbXMgPSBtYXRjaC5zbGljZSgxKVxuXG4gICAgaWYgQG5hbWVzLmxlbmd0aFxuICAgICAgZm9yIHBhcmFtLCBpIGluIHBhcmFtc1xuICAgICAgICBvcHRpb25zW0BuYW1lc1tpXV0gPSBwYXJhbVxuXG4gICAgQGNhbGxiYWNrLmNhbGwobnVsbCwgb3B0aW9ucykgaXNudCBmYWxzZVxuXG4jIENvZmZlZS1zY3JpcHQgYnVnXG5TcGluZS5Sb3V0ZS5jaGFuZ2UgPSBTcGluZS5Sb3V0ZS5wcm94eShTcGluZS5Sb3V0ZS5jaGFuZ2UpXG5cblNwaW5lLkNvbnRyb2xsZXIuaW5jbHVkZVxuICByb3V0ZTogKHBhdGgsIGNhbGxiYWNrKSAtPlxuICAgIFNwaW5lLlJvdXRlLmFkZChwYXRoLCBAcHJveHkoY2FsbGJhY2spKVxuXG4gIHJvdXRlczogKHJvdXRlcykgLT5cbiAgICBAcm91dGUoa2V5LCB2YWx1ZSkgZm9yIGtleSwgdmFsdWUgb2Ygcm91dGVzXG5cbiAgbmF2aWdhdGU6IC0+XG4gICAgU3BpbmUuUm91dGUubmF2aWdhdGUuYXBwbHkoU3BpbmUuUm91dGUsIGFyZ3VtZW50cylcblxubW9kdWxlPy5leHBvcnRzID0gU3BpbmUuUm91dGVcbiJdfQ==

*/
